---
title: "Основы программирования в R"
subtitle: "Лекция 1. Знакомство с R и RStudio."
author: "Алла Тамбовцева"
date: '13 сентября 2017 г '
output:
  html_document:
    toc: true
    theme: united
---
### Установка библиотек

Очень часто (на самом деле, всегда) для работы с данными предустановленных библиотек -- тех, которые были автоматически установлены вместе с R -- бывает недостаточно. Поэтому необходимые библиотеки нужно устанавливать самостоятельно. Для этого используется функция `install.packages()`. Для примера установим библиотеку `lmtest`.

```{r, eval=FALSE}
install.packages("lmtest")
```

**Важно:** название библиотеки нужно всегда указывать в кавычках. Если ввести название без кавычек, R не найдет библиотеку и выдаст ошибку (Error in install.packages : объект 'lmtest' не найден).

Иногда при установке библиотек можно столкнуться с проблемой: R пишет, что не может сохранить установочные файлы, так как нет доступа к нужной папке. Это обычно возникает в случае, если мы работаем в учетной записи, которая не является учетной записью администратора. Например, на компьютере есть пользователь Administrator (с неограниченными правами, в том числе по установке программ) и Student (с ограничениями). Решить проблему можно следующим образом: закрыть RStudio, щелкнуть по значку RStudio правой клавишей и выбрать "Запуск от имени администратора". После этого библиотеки должны устанавливаться нормально.

Для того чтобы использовать функционал установленной библиотеки, надо сначала к ней обратиться --иначе R не будет понимать, откуда брать запрашиваемые функции и писать "Ошибка: не могу найти функцию ...". Сделать это можно так: 

```{r, eval=FALSE}
library(lmtest)
```
Здесь уже можно вводить название библиотеки без кавычек.


### Ориентирование на местности

Рано или поздно при работе в R у нас появится необходимость загружать или сохранять данные. Чтобы загрузить данные из какого-нибудь файла Excel, нам потребуется сообщить R, где этот файл находится, то есть прописать путь к файлу. Обычно путь выглядит достаточно громоздко, например, так: `C:/User/Student/Документы/Мама-я-программист/данные.xls`. Поэтому, скорее всего, мы захотим поступить проще -- сообщить R, с какой папкой мы хотим работать, а затем просто указывать названия нужных файлов.

Папка, с которой работает R (откуда он запускается), называется рабочей. Узнать, какая папка является рабочей, можно так: 

```{r}
getwd() # wd -- working directory
```

Если мы хотим изменить рабочую папку, то поступаем так:

```{r, eval=FALSE}
setwd("C:/path/to/my/new/folder")
```

Теперь R будет видеть, что файлы, которые мы собираемся открыть, лежат в указанной папке folder. И сохранять файлы он тоже будет в эту папку.

### R как калькулятор

Базовые операции:

```{r}
12 + 18 
5 * 3
2 ^ 3 # возведение в степень
sqrt(16) # извлечение квадратного корня
16 ^ (1/4) # для корней степени больше 2
```

Округление:
```{r}
round(4/3) # округление (до целой части)
round(4/3, 2) # до второго знака после запятой
ceiling(4/3) # в большую сторону
floor(4/3) # в меньшую сторону
```

Математические константы и функции:
```{r}
pi 
exp(1) # константа e
exp(2) # e^2

sin(pi/2)
cos(pi/4)
tan(pi/4) 

log(exp(1)) # log - натуральный логарифм
log10(100) # log10 - десятичный логарифм
log(4, base = 2) # можем указать основание логарифма (base)
```

### Переменные в R

Названия переменных в R могут содержать буквы, цифры, точки и знаки подчеркивания, при этом название переменной не может начинаться с цифры. Название переменной не должно совпадать со служебными словами (операторами) в R: `if`, `else`, `for`, `while` и другимим.

Оба оператора `<-` и `=` используются для присваивания, но `<-` является основным в R и используется чаще. А точнее, всегда :)

```{r}
x <- 3
x
```
Мы можем изменить значение переменной и сохранить ее под тем же именем:

```{r}
x <- x + 3
x
```
### Типы переменных

Основными типами переменных в R являются:

* числовой (numeric)
* целочисленный (integer)
* текстовый (character)
* логический (logical) - только два значения: TRUE и FALSE

**Важно:** В дробных числах в R в качестве разделителя используется точка.

Создадим переменную x1 и присвоим ей значение 9.5.
```{r}
x1 <- 9.5
is.numeric(x1) # проверим, является ли числом
is.integer(x1) # проверим, является ли целым числом
is.character(x1) # проверим, является ли текстовой переменной
is.logical(x1) # проверим, является ли логической переменной 
```

Создадим переменную x2:

```{r}
x2 <- "welcome"
```

Узнаем, какого она типа:

```{r}
class(x2)
```

**Важно:** Если забыли, что делает та или иная функция, можно спросить это у R:

```{r, eval=FALSE}
?class # так
```

Или так:

```{r, eval=FALSE}
help(class)
```

### Числовые переменные

С числовыми переменными можно делать то же, что и с числами:

```{r}
a <- 25
b <- 15
sum_ab <- a + b # складывать или вычитать
sum_ab

prod_ab <- a * b # умножать или делить
prod_ab

power_ab <- a ^ b # возводить в степень и так далее
power_ab
```

`e` здесь - это число 10. Запись `9.313226e+20` означает, что число $9.313226$ надо умножить на $10^{20}$. Если, напротив, R нужно было бы выдать очень маленькое число, 10 стояло бы в отрицательной степени:

```{r}
2/23789
```

### Tекстовые переменные (строки)

Что можно делать с текстовыми переменными? Например, в текстовых переменных можно заменять одни символы на другие. Для этого существует функция `sub()`.

```{r}
s1 <- "respondent#1"
sub("#","_", s1) # (что заменяем, на что заменяем, где заменяем)
```

Однако функция `sub()` позволяет изменить только первое совпадение:

```{r}
s <- "respondent#1, respondent#2, respondent#3"
sub("#","_", s)
```

Для того, чтобы заменить все встречающиеся в тексте символы, нужно воспользоваться `gsub()`:

```{r}
gsub("#","_", s)
```

Если необходимо заменить определенную букву в слове независимо от ее регистра (строчная или заглавная), это можно специфицировать с помощью параметра `ignore.case`:

```{r}
text <- "Duggedt"
text <- gsub("d", "s", text, ignore.case = TRUE) # игнорируем регистр
text
```

Регистр букв в тексте тоже всегда можно поменять:

```{r}
order <- "CLOSE THE DOOR"
request <- tolower(order) # перевести все буквы в строчные
order; request # чтобы вывести две переменные сразу, можно указать их через ;
```

И наоборот:

```{r}
toupper(request) # перевести все буквы в заглавные
```

### Логические выражения

Необходимы для проверки или формулировки условий.

```{r}
x <- 2
y <- 10
```

Привычные выражения:

```{r}
x > y
x < y
x <= y
x == y # для проверки условия равенства - двойной знак =
```
Менее привычные:

```{r}
x != y # отрицание равенства
x & y < 5 # и (одновременно x и y)
x | y < 10 # или (хотя бы один из x и y)
```


